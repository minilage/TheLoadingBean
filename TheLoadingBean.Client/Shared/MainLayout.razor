@inherits LayoutComponentBase
@using TheLoadingBean.Client.Services
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<MudLayout>

    <MudAppBar Color="Color.Primary" Elevation="4">
        <MudText Typo="Typo.h6" Class="ml-2">The Loading Bean â˜•</MudText>

        <MudSpacer />

        <MudNavMenu Class="d-none d-md-flex">
            <MudNavLink Href="/" Match="NavLinkMatch.All">Home</MudNavLink>
            <MudNavLink Href="/products">Products</MudNavLink>
            <MudNavLink Href="/about">About Us</MudNavLink>
            <MudNavLink Href="/cart">Cart</MudNavLink>

            <AuthorizeView>
                <Authorized>
                    @if (AuthService.IsAdmin)
                    {
                        <MudNavLink Href="/admin">Admin</MudNavLink>
                    }
                    else
                    {
                        <MudNavLink Href="/orders">My Orders</MudNavLink>
                    }

                    <MudText Class="mx-2 mt-1" Typo="Typo.subtitle2">Hej, @context.User.Identity?.Name</MudText>
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="HandleLogout" Size="Size.Small">Logout</MudButton>
                </Authorized>
                <NotAuthorized>
                    <MudNavLink Href="/login">Login</MudNavLink>
                    <MudNavLink Href="/register">Register</MudNavLink>
                </NotAuthorized>
            </AuthorizeView>
        </MudNavMenu>
    </MudAppBar>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.False" Class="px-4 py-6">
            @Body
        </MudContainer>
    </MudMainContent>

</MudLayout>

<MudDialogProvider />
<MudSnackbarProvider />

@code {
    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/");
    }
}
